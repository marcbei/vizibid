<% provide(:title, 'Form Details')%>
<br/> 

<div class = "container">
	<%= render 'layouts/search' %>
	<br/>

	<div class="row">
		<% if @form.name != nil %>
			<H3><%= @form.name %><H3>
		<% else %>
			<H3><%= File.basename(@form.form.url, File.extname(@form.form.url)) %></H3><br/>
		<% end %>
		<strong>Jurisdiction: </strong> <%= @form.jurisdiction %> <br/>
		<strong>Uploaded by:</strong> <%=link_to @user, user_path(@form.user.id) %> <%= time_ago_in_words(@form.created_at) %> ago<br/>
		<%if @form.form_requests.count > 0 %>
			<strong>Associated with request: <%= link_to @form.form_requests.first.name, form_request_path(@form.form_requests.first.id) %><strong/><br/>
		<% end %>
		<strong>Form Downloaded: </strong> <%= @form.downloads.count %> times <br/>
		<strong>Average Rating: </strong> 
		<% if !@form.average_rating.nan? %>
			<%= @form.average_rating %>
		<% else %>
			Document has no ratings.
		<% end %>
		<br/><strong>Description:</strong> <%= @form.description %><br/><br/>
		<% if @form.keywords != nil %>
			<% if @form.keywords.length > 0 %>
				<em>Associated Keywords:</em><br/> <%= @form.keywords %></H1>
				<br/><br/>
			<% end %>
		<% end %>
		<%= link_to "Download", {:controller => "forms", :action =>"download", :id => @form.id}, :class => "downloadlink", :target => "_blank"%> 
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<% if @form.user.id != current_user.id && @inappropriate_document_report == nil%>
			<%= render 'layouts/inappropriate_document_modal', :formid => @form.id %>
			<br/><br/>
		<% end %>
		<% if @form.user.id != current_user.id && document_downloaded%>
			<div id = "ratingstext">
				<%if current_user_rating(@form.id) != "N/A" %>
					<h3>Your rating:</h3><br/>
				<% else %>
					<h3>Rate this form:</h3><br/>
				<% end %>
			</div>
			<%= render 'layouts/ratings_form' %>
		<% end %>
		<br/><br/><H3>Comments (<%=@comments.count%>)</H3>
		<hr/>
	</div>

	<div class = "row">
		<%= render 'layouts/form_comment_modal', :parent_id => nil, :form_id => @form.id, :button => true %>
		<% if !@form.comments.any? %>
			<h3>Please let us know what you think of this document. </h3><br/>
		<%else%>
			<br/><br/>
				<div class="btn-group">
				  <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
				    Sort by:
				    <span class="caret"></span>
				  </a>
				  <ul class="dropdown-menu">
				    <li><%= link_to :top, form_path(@form, :sorted_by => "top")%></li>
				    <li><%= link_to :newest, form_path(@form, :sorted_by => "new")%></li>
				    <li><%= link_to :oldest, form_path(@form, :sorted_by => "old")%></li>
				  </ul>
				</div>
		<%end%>

		<% if @form.comments.any? %>
			<ul class="comments">
				<% if @sort_by == "new" %>
					<%= nested_comments @form.comments.arrange(:order => "created_at desc") %>
				<% elsif @sort_by == "old" %>
					<%= nested_comments @form.comments.arrange(:order => "created_at asc") %>
				<% else %>
					<%= nested_comments @form.comments.arrange(:order => "score desc") %>
				<% end %>
			</ul>
		<% end %>
</div>
</div>
</div>