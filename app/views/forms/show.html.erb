<% provide(:title, 'Form Details')%>

<div class = "container-fluid">
	<%= render 'forms/search'%>
	<br/>

	<div class="row-fluid">
		<div class = "span8">
			<% if @form.name != nil %>
				<H4><%= @form.name %></H4>
			<% else %>
				<H4>
					<%= File.basename(@form.form.url, File.extname(@form.form.url)) %></H4>
			<% end %>

			<div style="margin-top: -7px;">
				<% name = @form.user.name.gsub(' ', '_') %>
				uploaded by <%=link_to @user, usershow_path(name.downcase) %> <%= time_ago_in_words(@form.created_at) %> ago<br/>
				downloaded <%= @form.downloads.count %> times
			</div>

			<div style="margin-top: 10px;">
				<% if @form.practice_area != nil %>
					<strong>Practice Area: </strong> <%= @form.practice_area.practice_area_title %> <br/>
				<% end %>
				<strong>Jurisdiction: </strong> <%= @form.jurisdiction %>
			</div>

			<div style="margin-top: 10px;">
				<% if @form.description != nil && @form.description.length > 0 %>
					<strong>Description:</strong> <%= @form.description %>
				<% end %>
				<br/>
				<% if @form.keywords != nil && @form.keywords.length > 0 %>
					<strong>Associated Keywords:</strong> <%= @form.keywords %>
				<% end %>
			</div>
			<br/>
			<strong>Average Rating: </strong> 
			<div class = "averagerating" style="Display: inline;">
				<% if !@form.average_rating.nan? %>
					<%= @form.average_rating.round(2) %>
				<% else %>
					Document has no ratings.
				<% end %>
			</div>
			<div id = "ratingstext">
				<% if @form.user.id != current_user.id && document_downloaded && @pemitted_user == true %>
					<div id = "ratingstext">
						<%if current_user_rating(@form.id) != "N/A" %>
							<strong>Your rating:</strong>
						<% else %>
							<strong>Rate this form:</strong>
						<% end %>
					<%= render 'forms/ratings_form' %>
				<% end %>
			</div>
			<br/>

			<%= render 'forms/form_download_modal', :form => @form %>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			<%= render 'forms/save_form_modal', :form => @form %>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			<%= render 'form_follows/form_follow_button', :formid => @form.id, :following => @following %>
			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			<%= render 'forms/share_form_modal', :form => @form %>
			<br/><br/>
			<% if @form.user.id != current_user.id && @inappropriate_document_report == nil && @pemitted_user == true %>
				<%= render 'forms/inappropriate_document_modal', :formid => @form.id %>
			<% end %>
			
			<br/><br/><H4>Responses (<%=@comments.count%>)</H4>
			<hr/>
		</div>
		<div class="span4">
			<%= render 'shared/dashboard' %>
		</div>
	</div>

	<% if @pemitted_user %>
		<div class = "row-fluid">
			<%= render 'forms/form_comment_modal', :parent_id => -1, :form_id => @form.id, :button => true %>
			<% if !@form.comments.any? %>
				<h4>Please let us know what you think of this document. </h4><br/>
			<%else%>
				<br/><br/>Sort by:
			 	<ul class="nav nav-pills">
				    <li 
				    <% if @sort_by == "top" || @sort_by == nil %>
				    class = "active" <% end %>><%= link_to :top, form_path(@form, :sorted_by => "top"), :remote => true%></li>
				    <li
				    <% if @sort_by == "new" %>
				    class = "active" <% end %>><%= link_to :newest, form_path(@form, :sorted_by => "new"), :remote => true%></li>
				    <li
				    <% if @sort_by == "old" %>
				    class = "active" <% end %>><%= link_to :oldest, form_path(@form, :sorted_by => "old"), :remote => true%></li>
			  	</ul>
			<%end%>

			<% if @form.comments.any? %>
				<%= render 'forms/form_comments' %>
			<% end %>
		<% end %>
	</div>
</div>