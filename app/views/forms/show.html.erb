<% provide(:title, 'Form Details')%>

<br/> 

<div class = "container">
	<%= render 'layouts/search' %>
	<br/>

	<div class="row">
		<% if @form.name != nil %>
			<H3><%= @form.name %><H3>
		<% else %>
			<H3><%= File.basename(@form.form.url, File.extname(@form.form.url)) %></H3><br/>
		<% end %>
		<strong>Jurisdiction: </strong> <%= @form.jurisdiction %> <br/>
		<strong>Uploaded by:</strong> <%=link_to @user, user_path(@form.user.id) %> <%= time_ago_in_words(@form.created_at) %> ago<br/>
		<%if @form.form_requests.count > 0 %>
			<strong>Associated with request: <%= link_to @form.form_requests.first.name, form_request_path(@form.form_requests.first.id) %><strong/><br/>
		<% end %>
		<strong>Form Downloaded: </strong> <%= @form.num_downloads %> times <br/>
		<strong>Average Rating: </strong> 
		<% if !@form.average_rating.nan? %>
			<%= @form.average_rating %>
		<% else %>
			Document has no ratings.
		<% end %>
		<br/><strong>Description:</strong> <%= @form.description %><br/><br/>
		<% if @form.keywords != nil %>
			<% if @form.keywords.length > 0 %>
				<em>Associated Keywords:</em><br/> <%= @form.keywords %></H1>
				<br/><br/>
			<% end %>
		<% end %>
		<%= link_to "Download", {:controller => "forms", :action =>"download", :id => @form.id}, :class => "downloadlink", :target => "_blank"%> 
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="#" style="color: red;">Report inappropriate document</a>
		<br/><br/>
		<% if @form.user.id != current_user.id %>
			<div id = "ratingstext">
				<%if current_user_rating(@form.id) != "N/A" %>
					<h3>Your rating:</h3><br/>
				<% else %>
					<h3>Rate this form:</h3><br/>
				<% end %>
			</div>
			<%= render 'layouts/ratings_form' %>
			<br/><br/>
		<% end %>
		<H3>Comments (<%=@comments.count%>)</H3>
		<hr/>
	</div>

	<div class = "row">
		<% if !@form.comments.any? %>
			<h3>Please let us know what you think of this form. </h3>
		<%end%>
		<%= form_for(@comment) do |f| %>
		  	<div class="commentfield">
		    	<%= f.text_area :content, placeholder: "Compose new comment...", :size=>"1x7" %>
		  	</div>
		  	<%= hidden_field_tag(:form_id, @form.id) %>
		  	<%= f.submit "Save", class: "btn btn-medium btn-primary" %>
		<% end %>

		<% if @form.comments.any? %>
		<ul class="comments">
			<% @form.comments.each do |comment| %>
				<li>
					<strong><%= comment.user.name %></strong>
					<span class="timestamp"><%= time_ago_in_words(comment.created_at) %> ago</span><br/>
					<span class="content"><%= comment.content %></span>
				</li>
			<% end %>
		</ul>
		<% end %>
</div>
</div>
</div>

<!-- modal dialogue for not signed in user???

		<a class="btn" data-toggle="modal" href="#myModal" >Launch Modal</a>
	<div class="modal hide fade" id="myModal">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal">×</button>
    <h3>Modal header</h3>
  </div>
  <div class="modal-body">
    <p>One fine body…</p>
  </div>

 -->